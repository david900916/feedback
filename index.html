<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å®¢äººå›é¥‹ï½œéœæ…‹é¡¯ç¤º</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --text:#1f2937; --muted:#6b7280; --brand:#2563eb; --chip:#eef2ff; --line:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;background:var(--bg);color:var(--text);}
    .wrap{max-width:980px;margin:0 auto;padding:20px;}
    header h1{margin:0 0 10px;font-weight:800;letter-spacing:.5px}
    header .sub{color:var(--muted);font-size:14px;margin-bottom:14px}

    /* æ§åˆ¶åˆ—ï¼ˆåƒ…ç€è¦½ç”¨ï¼‰ */
    .controls{display:grid;grid-template-columns:1fr;gap:10px;margin:14px 0 18px}
    @media(min-width:920px){.controls{grid-template-columns:1.2fr .9fr .9fr .9fr .8fr .6fr}}
    .control{display:flex;align-items:center;gap:8px;background:var(--card);border:1px solid var(--line);padding:8px 10px;border-radius:12px}
    .control input,.control select{width:100%;border:none;outline:none;background:transparent;font-size:14px}
    .control label{font-size:12px;color:var(--muted);white-space:nowrap}
    .toggle{display:flex;align-items:center;gap:8px;justify-content:center}

    /* åˆ—è¡¨å¡ç‰‡ */
    .list{display:flex;flex-direction:column;gap:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px 14px 12px;box-shadow:0 1px 1px rgba(0,0,0,.03)}
    .head{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .name{font-weight:700}
    .meta{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:13px}
    .loc{background:var(--chip);color:#4f46e5;border:1px solid #e0e7ff;padding:3px 8px;border-radius:999px;font-size:12px}
    .content{margin-top:8px;line-height:1.6;white-space:pre-wrap}
    .tools{display:flex;gap:10px;margin-top:8px}
    .btn-link{border:none;background:transparent;color:var(--brand);padding:0;font-size:13px;cursor:pointer}
    .divider{height:1px;background:var(--line);margin:10px 0 6px}

    /* å£“ç¸®æ¨¡å¼ */
    .compact .card{padding:10px}
    .compact .content{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}

    /* ç©ºç‹€æ…‹ */
    .empty{border:2px dashed var(--line);border-radius:16px;padding:24px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>å®¢äººå›é¥‹</h1>
      <div class="sub">ç´”éœæ…‹é¡¯ç¤ºï½œä½ åªéœ€åœ¨ç¨‹å¼ç¢¼ä¸Šæ–¹çš„è³‡æ–™å€å¡Šæ–°å¢è©•è«–ï¼ˆæä¾›å…©ç¨®æ ¼å¼ï¼‰</div>

      <div class="controls">
        <div class="control">
          <label for="q">æœå°‹</label>
          <input id="q" placeholder="å§“å / åœ°é» / å…§å®¹é—œéµå­—" />
        </div>
        <div class="control">
          <label for="place">åœ°é»</label>
          <select id="place"><option value="">å…¨éƒ¨åœ°é»</option></select>
        </div>
        <div class="control">
          <label for="from">èµ·æ—¥</label>
          <input id="from" type="date" />
        </div>
        <div class="control">
          <label for="to">è¿„æ—¥</label>
          <input id="to" type="date" />
        </div>
        <div class="control">
          <label for="sort">æ’åº</label>
          <select id="sort">
            <option value="newest">æœ€æ–°åœ¨å‰</option>
            <option value="oldest">æœ€èˆŠåœ¨å‰</option>
            <option value="nameAZ">å§“å Aâ†’Z</option>
            <option value="nameZA">å§“å Zâ†’A</option>
          </select>
        </div>
        <div class="control toggle">
          <input id="compact" type="checkbox" />
          <label for="compact">å£“ç¸®é¡¯ç¤º</label>
        </div>
      </div>
    </header>

    <div id="list" class="list" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å›é¥‹ã€‚</div>
  </div>

  <script>
    // ==============================
    // ğŸ”§ ä½ åªè¦æ”¹é€™ä¸€æ®µï¼ˆä¸‰é¸ä¸€ï¼‰
    // 1) ä½¿ç”¨ FEEDBACKS é™£åˆ—ï¼ˆæœ€ç›´è¦ºï¼‰ï¼šå°‡æ¯ç­†ä»¥ç‰©ä»¶å¯«å…¥
    // 2) ä½¿ç”¨ SOURCE_BLOCK ç´”æ–‡å­—ï¼ˆåƒè²¼ Google è©•è«–ï¼‰ï¼šæ¯ç­†é–“ç©ºä¸€è¡Œæˆ–ç”¨ --- åˆ†éš”
    // 3) ä½¿ç”¨é ç«¯ JSONï¼šæŠŠ DATA_MODE æ”¹æˆ 'remote'ï¼Œä¸¦è¨­å®š remoteUrl
    // ==============================

    const DATA_MODE = 'array'; // 'array' | 'block' | 'remote'

    // [é¸é … 1] ä»¥ã€Œé™£åˆ—ã€æ–°å¢ï¼ˆæ¨è–¦ï¼‰ï¼š
    // ç¯„ä¾‹ï¼š
    // { id: 1, name: 'ç‹å°æ˜', time: '2025-08-25 14:30', place: 'è€æ–°å°èœ Aé¤¨', content: 'é¤é»å¥½åƒï¼Œæœå‹™å¾ˆè²¼å¿ƒã€‚' }
    const FEEDBACKS = [
      { id: 1, name: 'é™³å°å§', time: '2025-08-20 18:32', place: 'è€æ–°å°èœâ€”Aé¤¨', content: 'ç¬¬ä¸€æ¬¡ä¾†ç”¨é¤ï¼Œæœå‹™ç”Ÿå¾ˆè¦ªåˆ‡ï¼Œèœè‰²ä¹Ÿå¾ˆæœ‰æ°´æº–ã€‚æ¤’éº»é›è¶…æ¨ï¼' },
      { id: 2, name: 'David', time: '2025-08-22T12:05:00', place: 'è€æ–°å°èœâ€”Bé¤¨', content: 'å®¶åº­èšé¤åº§ä½å®‰æ’å¾ˆèˆ’æœï¼Œå°å­©æœ‰ç©ºé–“æ´»å‹•ã€‚è¦é¬†å¾ˆå¥½åƒï¼Œä¸‹æ¬¡é‚„æœƒå†ä¾†ã€‚' },
      { id: 3, name: 'ç‹å…ˆç”Ÿ', time: '2025-08-23 19:10', place: 'è€æ–°å°èœâ€”å¤–å¸¶', content: 'å¤–å¸¶é€Ÿåº¦å¿«ï¼Œé¤é»ä¿æº«åšå¾—ä¸éŒ¯ï¼›å»ºè­°ç´™è¢‹åº•éƒ¨å†åšä¸€äº›ã€‚' },
      { id: 4, name: 'æ—å¤ªå¤ª', time: '2025-08-24 13:45', place: 'è€æ–°å°èœâ€”Aé¤¨', content: 'åŒ…å»‚ç‡ˆå…‰ç¨æš—ï¼Œä½†ç§å¯†æ„Ÿå¾ˆæ£’ã€‚å–œæ­¡ä½ å€‘çš„ç´…ç‡’ç‰›è…©èˆ‡è±¬è…³ã€‚' },
    ];

    // [é¸é … 2] ä»¥ã€Œç´”æ–‡å­—ã€æ–°å¢ï¼ˆåƒ Google è©•è«–é‚£æ¨£é»è²¼ï¼‰ï¼š
    // å…è¨± 3 ç¨®æ ¼å¼ï¼ˆæ¯ç­†é–“è«‹ç©ºä¸€è¡Œæˆ–ç”¨ --- åˆ†éš”ï¼‰ï¼š
    //  A) å…§å®¹\nå§“åï½œYYYY-MM-DD HH:mmï½œåœ°é»
    //  B) å…§å®¹\nå§“åï½œYYYY-MM-DD HH:mm
    //  C) å…§å®¹\nå§“å\nYYYY-MM-DD HH:mm\nåœ°é»(å¯çœç•¥)
    const SOURCE_BLOCK = `
å¤–å¸¶é€Ÿåº¦å¿«ï¼Œé¤é»ä¿æº«åšå¾—ä¸éŒ¯ï¼›å»ºè­°ç´™è¢‹åº•éƒ¨å†åšä¸€äº›ã€‚
ç‹å…ˆç”Ÿï½œ2025-08-23 19:10ï½œè€æ–°å°èœâ€”å¤–å¸¶

ç¬¬ä¸€æ¬¡ä¾†ç”¨é¤ï¼Œæœå‹™ç”Ÿå¾ˆè¦ªåˆ‡ï¼Œèœè‰²ä¹Ÿå¾ˆæœ‰æ°´æº–ã€‚æ¤’éº»é›è¶…æ¨ï¼
é™³å°å§ï½œ2025-08-20 18:32ï½œè€æ–°å°èœâ€”Aé¤¨

å®¶åº­èšé¤åº§ä½å®‰æ’å¾ˆèˆ’æœï¼Œå°å­©æœ‰ç©ºé–“æ´»å‹•ã€‚è¦é¬†å¾ˆå¥½åƒï¼Œä¸‹æ¬¡é‚„æœƒå†ä¾†ã€‚
Davidï½œ2025-08-22 12:05
---
åŒ…å»‚ç‡ˆå…‰ç¨æš—ï¼Œä½†ç§å¯†æ„Ÿå¾ˆæ£’ã€‚å–œæ­¡ä½ å€‘çš„ç´…ç‡’ç‰›è…©èˆ‡è±¬è…³ã€‚
æ—å¤ªå¤ª
2025-08-24 13:45
è€æ–°å°èœâ€”Aé¤¨
`;

    // [é¸é … 3] é ç«¯ JSONï¼ˆç¶­æŒç´”éœæ…‹ã€æ–¹ä¾¿æ‰¹æ¬¡æ›´æ–°ï¼‰ï¼š
    const remoteUrl = './feedbacks.json';

    // ==============================
    // ä¸»ç¨‹å¼ï¼ˆåªè² è²¬é¡¯ç¤ºï¼‰
    // ==============================
    const $list  = document.getElementById('list');
    const $empty = document.getElementById('empty');
    const $q     = document.getElementById('q');
    const $place = document.getElementById('place');
    const $from  = document.getElementById('from');
    const $to    = document.getElementById('to');
    const $sort  = document.getElementById('sort');
    const $compact = document.getElementById('compact');

    let DATA = [];

    function parseTime(t){
      if (!t) return new Date();
      if (/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}/.test(t)){
        const [d, hm] = t.split(' ');
        return new Date(d+"T"+hm+":00");
      }
      return new Date(t);
    }
    function fmt(dt){
      if (!(dt instanceof Date) || isNaN(dt)) return '';
      const pad = n => String(n).padStart(2,'0');
      return `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())} ${pad(dt.getHours())}:${pad(dt.getMinutes())}`;
    }

    function uniquePlaces(list){
      return Array.from(new Set(list.map(x=>x.place).filter(Boolean)));
    }
    function populatePlaceFilter(list){
      const places = uniquePlaces(list);
      const cur = $place.value;
      $place.innerHTML = '<option value="">å…¨éƒ¨åœ°é»</option>' + places.map(p=>`<option value="${escapeHtml(p)}">${escapeHtml(p)}</option>`).join('');
      if (places.includes(cur)) $place.value = cur;
    }
    function escapeHtml(s){
      return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;');
    }
    function inRange(date, from, to){
      if (from && date < from) return false;
      if (to){
        const end = new Date(to.getFullYear(), to.getMonth(), to.getDate(), 23,59,59,999);
        if (date > end) return false;
      }
      return true;
    }

    function filterAndSort(){
      const kw = $q.value.trim().toLowerCase();
      const place = $place.value;
      const from = $from.value ? new Date($from.value) : null;
      const to   = $to.value   ? new Date($to.value)   : null;
      const sort = $sort.value;

      let list = DATA.filter(x=>{
        const text = `${x.name} ${x.place} ${x.content}`.toLowerCase();
        const hitKw = !kw || text.includes(kw);
        const hitPl = !place || x.place === place;
        const dt = parseTime(x.time);
        const hitDate = inRange(dt, from, to);
        return hitKw && hitPl && hitDate;
      });

      list.sort((a,b)=>{
        if (sort === 'newest') return parseTime(b.time) - parseTime(a.time);
        if (sort === 'oldest') return parseTime(a.time) - parseTime(b.time);
        if (sort === 'nameAZ') return a.name.localeCompare(b.name,'zh-Hant');
        if (sort === 'nameZA') return b.name.localeCompare(a.name,'zh-Hant');
        return 0;
      });
      return list;
    }

    function render(){
      const list = filterAndSort();
      $list.classList.toggle('compact', $compact.checked);

      if (list.length === 0){
        $list.innerHTML = '';
        $empty.style.display = '';
        return;
      }
      $empty.style.display = 'none';
      $list.innerHTML = list.map(item=>{
        const dt = parseTime(item.time);
        return `<article class=\"card\" id=\"f-${item.id}\" aria-label=\"${escapeHtml(item.name)} çš„å›é¥‹\">\n          <div class=\"head\">\n            <div class=\"name\">${escapeHtml(item.name)}</div>\n            <div class=\"meta\">\n              <span title=\"æ™‚é–“\">${fmt(dt)}</span>\n              ${item.place?`<span class=\"loc\" title=\"åœ°é»\">${escapeHtml(item.place)}</span>`:''}\n            </div>\n          </div>\n          <div class=\"divider\"></div>\n          <div class=\"content\" data-full=\"${escapeHtml(item.content)}\">${escapeHtml(item.content)}</div>\n          <div class=\"tools\">\n            <button class=\"btn-link\" data-act=\"toggle\">å±•é–‹/æ”¶åˆ</button>\n            <a class=\"btn-link\" href=\"#f-${item.id}\">é€£çµ</a>\n          </div>\n        </article>`
      }).join('');
    }

    function onListClick(e){
      const btn = e.target.closest('[data-act=toggle]');
      if (!btn) return;
      const card = e.target.closest('.card');
      const content = card.querySelector('.content');
      if ($list.classList.contains('compact')){
        content.style.display = content.style.display === 'block' ? '' : 'block';
      }else{
        if (content.style.display === '-webkit-box'){
          content.style.display = '';
        }else{
          content.style.display = '-webkit-box';
          content.style.webkitLineClamp = '4';
          content.style.webkitBoxOrient = 'vertical';
          content.style.overflow = 'hidden';
        }
      }
    }

    function attachEvents(){
      [$q,$place,$from,$to,$sort,$compact].forEach(el=> el.addEventListener('input', render));
      $list.addEventListener('click', onListClick);
    }

    function parseBlock(text){
      const blocks = text.split(/\n\s*(?:---|\n)\s*\n/).map(s=>s.trim()).filter(Boolean);
      const out = [];
      let autoId = 1;
      for (const b of blocks){
        const lines = b.split(/\n+/).map(s=>s.trim()).filter(Boolean);
        if (lines.length===0) continue;
        const content = lines[0];
        let name='', time='', place='';
        if (lines[1]){
          const parts = lines[1].split(/\s*[|ï½œ]\s*/);
          if (parts.length>=2){
            [name,time,place] = parts;
          }else{
            name = lines[1] || '';
            time = lines[2] || '';
            place = lines[3] || '';
          }
        }
        const dt = parseTime(time);
        out.push({ id: autoId++, name: name||'è¨ªå®¢', time: isNaN(dt)? new Date().toISOString(): dt.toISOString(), place, content });
      }
      return out;
    }

    async function loadData(){
  DATA = FEEDBACKS.slice(); // å…ˆç”¨å…§å»ºé™£åˆ—
  try{
    const res = await fetch(remoteUrl, {cache:'no-store'});
    const jsonData = await res.json();
    // åˆä½µï¼šæŠŠ JSON è³‡æ–™æ¥åœ¨å¾Œé¢
    DATA = DATA.concat(jsonData);
  }catch(err){
    console.error("è¼‰å…¥ JSON å¤±æ•—ï¼Œåƒ…ä½¿ç”¨å…§å»ºè³‡æ–™", err);
  }
  afterLoad();
}


    function afterLoad(){
      DATA = DATA.map((x,i)=>({
        id: x.id ?? (i+1),
        name: x.name ?? 'è¨ªå®¢',
        time: x.time ?? new Date().toISOString(),
        place: x.place ?? '',
        content: x.content ?? ''
      }));
      populatePlaceFilter(DATA);
      render();
    }

    attachEvents();
    loadData();
  </script>
</body>
</html>
